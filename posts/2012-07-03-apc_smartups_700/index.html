<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>APC Smart UPS 700: Serielle Schnittstelle (2012) - Michael Stapelberg</title>

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="shortcut icon" href="/favicon.ico" />
  <meta name="description" content="Vor einer Weile habe ich eine alte APC Smart UPS 700 bekommen, für die ich neue Batterien gekauft und eingebaut habe. Nun bin ich dazu gekommen, zu testen, ob die UPS läuft.  Wichtig zu erwähnen ist dabei, dass die APCs keine normale Belegung der Seriellen Schnittstelle benutzen.">
  <link rel="canonical" href="https://michael.stapelberg.ch/posts/2012-07-03-apc_smartups_700/">
  <meta name="author" content="Michael Stapelberg">
  <style type="text/css">
    @font-face {
	font-family: 'Roboto Mono';
	src: url('/font/subset-RobotoMono-Regular.eot');
	src: local('Roboto Mono Regular'), local('RobotoMono-Regular'),
        url('/font/subset-RobotoMono-Regular.eot?#iefix') format('embedded-opentype'),
        url('/font/subset-RobotoMono-Regular.woff2') format('woff2'),
        url('/font/subset-RobotoMono-Regular.woff') format('woff'),
        url('/font/subset-RobotoMono-Regular.ttf') format('truetype');
	font-weight: normal;
	font-style: normal;
	font-display: swap;
    }

    @font-face {
	font-family: 'Roboto';
	src: url('/font/subset-Roboto-Bold.eot');
	src: local('Roboto Bold'), local('Roboto-Bold'),
        url('/font/subset-Roboto-Bold.eot?#iefix') format('embedded-opentype'),
        url('/font/subset-Roboto-Bold.woff2') format('woff2'),
        url('/font/subset-Roboto-Bold.woff') format('woff'),
        url('/font/subset-Roboto-Bold.ttf') format('truetype');
	font-weight: bold;
	font-style: normal;
	font-display: swap;
    }

    @font-face {
	font-family: 'Roboto';
	src: url('/font/subset-Roboto-Regular.eot');
	src: local('Roboto'), local('Roboto-Regular'),
        url('/font/subset-Roboto-Regular.eot?#iefix') format('embedded-opentype'),
        url('/font/subset-Roboto-Regular.woff2') format('woff2'),
        url('/font/subset-Roboto-Regular.woff') format('woff'),
        url('/font/subset-Roboto-Regular.ttf') format('truetype');
	font-weight: normal;
	font-style: normal;
	font-display: swap;
    }

    @font-face {
	font-family: 'Lato';
	src: url('/font/subset-Lato-Bold.eot');
	src: local('Lato Bold'), local('Lato-Bold'),
        url('/font/subset-Lato-Bold.eot?#iefix') format('embedded-opentype'),
        url('/font/subset-Lato-Bold.woff2') format('woff2'),
        url('/font/subset-Lato-Bold.woff') format('woff'),
        url('/font/subset-Lato-Bold.ttf') format('truetype');
	font-weight: bold;
	font-style: normal;
	font-display: swap;
    }

    body, td, th {
	font-family: 'Roboto';
	font-size: 16px;
	line-height: 150%;
	color: #000;
    }

    h1,
    h2,
    h3,
    h4,
    h5,
    h6 {
	font-family: 'Lato';
	font-weight: bold;
	font-variant-ligatures: none;
	color: #000;
    }
  </style>

  
  <link rel="preload" href="/font/subset-Lato-Bold.woff2" as="font" type="font/woff2" crossorigin>
  <link rel="preload" href="/font/subset-Roboto-Regular.woff2" as="font" type="font/woff2" crossorigin>
  
  <link rel="stylesheet" href="/1.min.css" type="text/css">
  <link rel="alternate" href="/feed.xml" type="application/atom+xml" title="ATOM feed">
</head>
<body>



<header id="ms_navbar">
  <a href="/">
<img
    src="/logo1x.jpg"
    srcset="/logo2x.jpg 2x, /logo3x.jpg 3x"
    width="42"
    height="52"
    alt="profile picture"
    title="profile picture">
</a>
  <div>
    <a href="/"><h1>Michael Stapelberg</h1></a>
    <nav id="ms_desktopnav">
      <ul>
	
    <li><a href="/" >About</a></li>
    <li><a href="/posts/" class="active">Blog</a></li>
    <li><a href="/talks/" >Talks</a></li>
    <li><a href="/series/" >Series</a></li>

      </ul>
    </nav>
  </div>

  <div id="ms_burger_open">
    <label for="ms_burger"><svg viewBox="0 0 100 80" width="24" height="24">
	<rect width="100" height="17" rx="8" fill="white"></rect>
	<rect y="30" width="100" height="17" rx="8" fill="white"></rect>
	<rect y="60" width="100" height="17" rx="8" fill="white"></rect>
    </svg></label>
  </div>

  <input type="checkbox" id="ms_burger">

  <nav id="ms_navdrawer">
    <div id="ms_navdrawer_top">
      <div id="ms_navdrawer_search">
	<a href="/">
<img
    src="/logo1x.jpg"
    srcset="/logo2x.jpg 2x, /logo3x.jpg 3x"
    width="42"
    height="52"
    alt="profile picture"
    title="profile picture">

	<h1>Michael Stapelberg</h1></a>
      </div>
      <div id="ms_burger_close">
	<label for="ms_burger"><svg viewBox="0 0 110 110" width="24" height="24">
	    <line x1="10" y1="10" x2="100" y2="100" stroke="#047bc2" stroke-width="20" />
	    <line x1="100" y1="10" x2="10" y2="100" stroke="#047bc2" stroke-width="20" />
	</svg></label>
      </div>
    </div>

    <div id="ms_navdrawer_content">
      <ul>
	
    <li><a href="/" >About</a></li>
    <li><a href="/posts/" class="active">Blog</a></li>
    <li><a href="/talks/" >Talks</a></li>
    <li><a href="/series/" >Series</a></li>

      </ul>
    </div>
  </nav>
</header>
<main>
      <div>
<h1 class="ms_title">APC Smart UPS 700: Serielle Schnittstelle (2012)</h1>

<div class="ms_meta">
  <div id="ms_date">published 2012-07-03, last modified 2018-03-18</div>
  
  
  <div>
    <a href="https://github.com/stapelberg/hugo/edit/master/content/posts/2012-07-03-APC_SmartUPS_700.markdown"><img src="/Bilder/pen-square-solid.svg" width="18" height="20" alt="Edit Icon" title="Suggest a change to this article"></a>
  </div>
  
</div>
<div class="Artikel" id="content">
  <p>
Vor einer Weile habe ich eine alte APC Smart UPS 700 bekommen, für die ich neue
Batterien gekauft und eingebaut habe. Nun bin ich dazu gekommen, zu testen, ob
die UPS läuft.
</p>

<p>
Wichtig zu erwähnen ist dabei, dass die APCs <strong>keine</strong> normale
Belegung der Seriellen Schnittstelle benutzen. Sofern man ein 1:1- oder
Nullmodemkabel anschließt, schaltet sich die APC direkt aus (und damit alle
Geräte, die angeschlossen sind!).
</p>

<p>
Stattdessen liefert APC ein Kabel mit, welches die Bezeichnung 940-0024C hat.
Bei diesem Kabel sind einfach RX, TX und GND anders verdrahtet, als bei
normalen RS232-Schnittstellen.
</p>

<p>
Wenn man so ein Kabel gerade nicht greifbar hat, kann man sich selbst eins
basteln, wie das geht steht <a
href="http://lists.alioth.debian.org/pipermail/nut-upsuser/2005-August/000118.html">in
diesem Post von Stepan Novotill</a>. Hierbei beachten: Der Post bezieht sich
auf ein Kabel (!), nicht auf die Buchsenbelegung am Gerät.
</p>

<p>
Weiterhin wichtig: Die serielle Schnittstelle arbeitet mit 12V-Pegeln. Ein
USB-to-Serial-Adapter, der nur mit 5V oder gar 3,3V klarkommt, wird hier nicht
(richtig) funktionieren.
</p>

<p>
Ihr braucht also einen geeigneten seriellen Port, z.B. in eurem Rechner. Da
moderne Rechner keinen seriellen Port mehr direkt auf dem Mainboard
herausgeführt haben, gibts dafür meist eine Stiftleiste und einen zusätzlichen
Adapter. Zu beachten ist hierbei, dass Intel eine Belegung für die Stiftleiste
verwendet, die mit dem Adapter, den ich hier habe, nicht übereinstimmt. Hier
empfiehlt sich also der Abgleich der Belegung, eventuell mit dem
Durchgangsprüfer eines Multimeters.
</p>

<p>
Nachdem das dann alles erledigt ist, müsste das Programm <code>apctest</code>
die APC erkennen, das sieht dann so aus:
</p>

<pre>
2012-07-03 22:37:35 apctest 3.14.10 (13 September 2011) debian
Checking configuration ...
Attached to driver: apcsmart
sharenet.type = Network & ShareUPS Disabled
cable.type = Custom Cable Smart
mode.type = APC Smart UPS (any)
Setting up the port ...
Doing prep_device() ...

You are using a SMART cable type, so I'm entering SMART test mode
Hello, this is the apcupsd Cable Test program.
This part of apctest is for testing Smart UPSes.
Please select the function you want to perform.

1) Query the UPS for all known values
2) Perform a Battery Runtime Calibration
3) Abort Battery Calibration
4) Monitor Battery Calibration progress
5) Program EEPROM
6) Enter TTY mode communicating with UPS
Q) Quit
</pre>

<p>
Intern sendet apctest dazu zunächst ein "Y" zur APC und wartet, ob es "SM" (für
Smart Mode) zurückbekommt.
</p>

<p>
Bei mir war die Konfigurationsdatei <code>/etc/apcupsd/apcupsd.conf</code> wie
sie in Debian ausgeliefert wird schon direkt nutzbar. Hier der Vollständigkeit
halber die relevanten Parameter:
</p>

<pre>
UPSCABLE smart
UPSTYPE apcsmart
DEVICE /dev/ttyS0
</pre>

</div>

      </div>

    </main><div id="ms_footer">
  © 2021 Michael Stapelberg • all articles under <a href="https://creativecommons.org/licenses/by/4.0/">Creative Commons CC-BY license</a>
</div>
</body>
</html>
