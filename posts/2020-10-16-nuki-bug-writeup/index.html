<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Bug Report: Defekter Nuki Opener (an BTicino 344212) (2020) - Michael Stapelberg</title>

  <meta property="og:site_name" content="Michael Stapelberg">
  <meta property="og:title" content="Bug Report: Defekter Nuki Opener (an BTicino 344212)">
  <meta property="og:description" content="Update 2020-11-03: Ich habe den zweiten Nuki Opener auf Software-Version 1.5.3 aktualisiert, und wider erwarten funktioniert er!
Offenbar war mein erster Nuki Opener defekt.
   Ich habe kürzlich einen Nuki Opener gekauft und leider nicht in Betrieb nehmen können.">
  
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="shortcut icon" href="/favicon.ico" />
  <meta name="description" content="Update 2020-11-03: Ich habe den zweiten Nuki Opener auf Software-Version 1.5.3 aktualisiert, und wider erwarten funktioniert er!
Offenbar war mein erster Nuki Opener defekt.
   Ich habe kürzlich einen Nuki Opener gekauft und leider nicht in Betrieb nehmen können.">
  <link rel="canonical" href="https://michael.stapelberg.ch/posts/2020-10-16-nuki-bug-writeup/">
  <meta name="author" content="Michael Stapelberg">
  <style type="text/css">
    @font-face {
	font-family: 'Roboto Mono';
	src: url('/font/subset-RobotoMono-Regular.eot');
	src: local('Roboto Mono Regular'), local('RobotoMono-Regular'),
        url('/font/subset-RobotoMono-Regular.eot?#iefix') format('embedded-opentype'),
        url('/font/subset-RobotoMono-Regular.woff2') format('woff2'),
        url('/font/subset-RobotoMono-Regular.woff') format('woff'),
        url('/font/subset-RobotoMono-Regular.ttf') format('truetype');
	font-weight: normal;
	font-style: normal;
	font-display: swap;
    }

    @font-face {
	font-family: 'Roboto';
	src: url('/font/subset-Roboto-Bold.eot');
	src: local('Roboto Bold'), local('Roboto-Bold'),
        url('/font/subset-Roboto-Bold.eot?#iefix') format('embedded-opentype'),
        url('/font/subset-Roboto-Bold.woff2') format('woff2'),
        url('/font/subset-Roboto-Bold.woff') format('woff'),
        url('/font/subset-Roboto-Bold.ttf') format('truetype');
	font-weight: bold;
	font-style: normal;
	font-display: swap;
    }

    @font-face {
	font-family: 'Roboto';
	src: url('/font/subset-Roboto-Regular.eot');
	src: local('Roboto'), local('Roboto-Regular'),
        url('/font/subset-Roboto-Regular.eot?#iefix') format('embedded-opentype'),
        url('/font/subset-Roboto-Regular.woff2') format('woff2'),
        url('/font/subset-Roboto-Regular.woff') format('woff'),
        url('/font/subset-Roboto-Regular.ttf') format('truetype');
	font-weight: normal;
	font-style: normal;
	font-display: swap;
    }

    @font-face {
	font-family: 'Lato';
	src: url('/font/subset-Lato-Bold.eot');
	src: local('Lato Bold'), local('Lato-Bold'),
        url('/font/subset-Lato-Bold.eot?#iefix') format('embedded-opentype'),
        url('/font/subset-Lato-Bold.woff2') format('woff2'),
        url('/font/subset-Lato-Bold.woff') format('woff'),
        url('/font/subset-Lato-Bold.ttf') format('truetype');
	font-weight: bold;
	font-style: normal;
	font-display: swap;
    }

    body, td, th {
	font-family: 'Roboto';
	font-size: 16px;
	line-height: 150%;
	color: #000;
    }

    h1,
    h2,
    h3,
    h4,
    h5,
    h6 {
	font-family: 'Lato';
	font-weight: bold;
	font-variant-ligatures: none;
	color: #000;
    }
  </style>

  
  <link rel="preload" href="/font/subset-Lato-Bold.woff2" as="font" type="font/woff2" crossorigin>
  <link rel="preload" href="/font/subset-Roboto-Regular.woff2" as="font" type="font/woff2" crossorigin>
  
  <link rel="stylesheet" href="/1.min.css" type="text/css">
  <link rel="alternate" href="/feed.xml" type="application/atom+xml" title="ATOM feed">
</head>
<body>



<header id="ms_navbar">
  <a href="/">
<img
    src="/logo1x.jpg"
    srcset="/logo2x.jpg 2x, /logo3x.jpg 3x"
    width="42"
    height="52"
    alt="profile picture"
    title="profile picture">
</a>
  <div>
    <a href="/"><h1>Michael Stapelberg</h1></a>
    <nav id="ms_desktopnav">
      <ul>
	
    <li><a href="/" >About</a></li>
    <li><a href="/posts/" class="active">Blog</a></li>
    <li><a href="/talks/" >Talks</a></li>
    <li><a href="/series/" >Series</a></li>

      </ul>
    </nav>
  </div>

  <div id="ms_burger_open">
    <label for="ms_burger"><svg viewBox="0 0 100 80" width="24" height="24">
	<rect width="100" height="17" rx="8" fill="white"></rect>
	<rect y="30" width="100" height="17" rx="8" fill="white"></rect>
	<rect y="60" width="100" height="17" rx="8" fill="white"></rect>
    </svg></label>
  </div>

  <input type="checkbox" id="ms_burger">

  <nav id="ms_navdrawer">
    <div id="ms_navdrawer_top">
      <div id="ms_navdrawer_search">
	<a href="/">
<img
    src="/logo1x.jpg"
    srcset="/logo2x.jpg 2x, /logo3x.jpg 3x"
    width="42"
    height="52"
    alt="profile picture"
    title="profile picture">

	<h1>Michael Stapelberg</h1></a>
      </div>
      <div id="ms_burger_close">
	<label for="ms_burger"><svg viewBox="0 0 110 110" width="24" height="24">
	    <line x1="10" y1="10" x2="100" y2="100" stroke="#047bc2" stroke-width="20" />
	    <line x1="100" y1="10" x2="10" y2="100" stroke="#047bc2" stroke-width="20" />
	</svg></label>
      </div>
    </div>

    <div id="ms_navdrawer_content">
      <ul>
	
    <li><a href="/" >About</a></li>
    <li><a href="/posts/" class="active">Blog</a></li>
    <li><a href="/talks/" >Talks</a></li>
    <li><a href="/series/" >Series</a></li>

      </ul>
    </div>
  </nav>
</header>
<main>
      <div>
<h1 class="ms_title">Bug Report: Defekter Nuki Opener (an BTicino 344212) (2020)</h1>

<div class="ms_meta">
  <div id="ms_date">published 2020-10-16, last modified 2020-11-03</div>
  
  
  <div>
    <a href="https://github.com/stapelberg/hugo/edit/master/content/posts/2020-10-16-nuki-bug-writeup.markdown"><img src="/Bilder/pen-square-solid.svg" width="18" height="20" alt="Edit Icon" title="Suggest a change to this article"></a>
  </div>
  
</div>
<div class="Artikel" id="content">
  

<aside class="admonition note">
  <div class="note-container">
    <div class="note-icon">
      <svg id="exclamation-icon" width="100%" height="100%" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:1.41421;">
    <path d="M0,0L24,0L24,24L0,24L0,0Z" style="fill:none;"/>
    <g transform="matrix(1.2,0,0,1.2,-2.4,-2.4)">
        <path d="M12,2C6.48,2 2,6.48 2,12C2,17.52 6.48,22 12,22C17.52,22 22,17.52 22,12C22,6.48 17.52,2 12,2ZM13,17L11,17L11,15L13,15L13,17ZM13,13L11,13L11,7L13,7L13,13Z" style="fill-rule:nonzero;"/>
    </g>
</svg>

    </div>
    <div class="admonition-content"><p><strong>Update 2020-11-03:</strong> Ich habe den zweiten Nuki Opener auf Software-Version
1.5.3 aktualisiert, und wider erwarten funktioniert er!</p>

<p>Offenbar war mein erster Nuki Opener defekt.</p>
</div>
  </div>
</aside>


<p>Ich habe kürzlich einen Nuki Opener gekauft und leider nicht in Betrieb nehmen
können.</p>

<p>Den Nuki Opener konnte ich zwar anlernen, aber wenn er versucht, die Tür zu
öffnen, passiert im Haus einfach nichts — die Klingelanlage reagiert nicht.</p>

<p>Nachdem ich mit dem Nuki Support nicht weiterkam, habe ich mir zum Vergleich
einen zweiten Nuki Opener gekauft.</p>

<p>Mit dem <strong>zweiten Nuki Opener funktioniert</strong> die gleiche Modellwahl (Hersteller
BTicino, Modell 344212) und <a href="/posts/2020-09-28-nuki-scs-bticino-decoding/">gleiche
Verkabelung</a>: die Klingelanlage
entsperrt die Tür.</p>

<p>Ein Unterschied zwischen den beiden Geräten: der zweite Opener läuft noch mit
der alten Software-Version:</p>

<table>
<thead>
<tr>
<th>Gerät</th>
<th>Software-Version</th>
<th>Funktioniert?</th>
</tr>
</thead>

<tbody>
<tr>
<td>Nuki Opener #1</td>
<td>1.5.3 (aktuell)</td>
<td>kaputt :-(</td>
</tr>

<tr>
<td>Nuki Opener #2</td>
<td>1.3.1</td>
<td>funktioniert!</td>
</tr>

<tr>
<td>Nuki Opener #2</td>
<td>1.5.3</td>
<td>funktioniert!</td>
</tr>
</tbody>
</table>

<p><s>Für mich sieht alles danach aus, als ob sich in neuere Software-Versionen ein
Fehler eingeschlichen hat.</s></p>

<p>Meine Oszilloskop-Aufzeichnungen beider Software-Versionen belegen, dass das
Signal, welches der Nuki Opener #1 auf den <a href="https://en.wikipedia.org/wiki/Bus_SCS">BTicino SCS
Bus</a> schickt, kaputt ist!</p>

<p>Ich stelle die rohen Messwerte jeweils in mehreren Formaten zur Verfügung, mit
denen die Engineers bei Nuki das Problem einfach nachstellen und beheben können:</p>

<ul>
<li><p>Die original Rigol Waveform-Dateien kann man mit <a href="https://www.rigolna.com/download/">Rigol
Ultrascope</a> öffnen.</p></li>

<li><p>Bequemer ist wohl, die CSV-Variante in andere Waveform Viewer zu importieren.</p></li>

<li><p><a href="/posts/2020-09-28-nuki-scs-bticino-decoding/">SCS Signale dekodiert man am
einfachsten</a> mit dem <a href="https://sigrok.org/">freien
Logic Analyzer sigrok</a>.</p></li>
</ul>

<h2 id="nuki-opener-software-version-1-3-1-funktioniert">Nuki Opener Software-Version 1.3.1 (funktioniert)</h2>

<p>Mit Software-Version 1.3.1 erscheint nach dem Anlernen im Debug Protokoll:</p>

<pre><code>bv/ct:276/260dV,ba:22%
R:n75,m35@0,d7
O:n67,m32@0,d7
</code></pre>

<p>Die <code>n</code> und <code>m</code> Werte entsprechen etwa den relevanten Zeiten auf dem SCS Bus, wo
einzelne Bits 104μs lang sind, aufgeteilt in 34μs für High/Low und 70μs Stille.</p>

<p>Die Base Voltage (<code>bv</code>) von 27.6V, und der Comparator Trigger (<code>ct</code>) von 26.0V
stimmen mit den erwarteten Pegeln des SCS Bus überein.</p>

<table>
<thead>
<tr>
<th>Oszilloskop-Aufzeichnung SCS Bus</th>
<th>Rigol Waveform</th>
<th>CSV</th>
<th>Sigrok</th>
</tr>
</thead>

<tbody>
<tr>
<td>2020-10-15-nuki131-door-open.sr</td>
<td><a href="/nuki/2020-10-15-nuki131-door-open.wfm">wfm (1,1 MB)</a></td>
<td><a href="/nuki/2020-10-15-nuki131-door-open.zip">csv (2 MB)</a></td>
<td><a href="/nuki/2020-10-15-nuki131-door-open.sr">sr (160 KB)</a></td>
</tr>

<tr>
<td>2020-10-15-nuki131-ring.sr</td>
<td><a href="/nuki/2020-10-15-nuki131-ring.wfm">wfm (1,1 MB)</a></td>
<td><a href="/nuki/2020-10-15-nuki131-ring.zip">csv (2 MB)</a></td>
<td><a href="/nuki/2020-10-15-nuki131-ring.sr">sr (160 KB)</a></td>
</tr>

<tr>
<td>2020-10-15-nuki131-nuki-open.sr</td>
<td><a href="/nuki/2020-10-15-nuki131-nuki-open.wfm">wfm (1,1 MB)</a></td>
<td><a href="/nuki/2020-10-15-nuki131-nuki-open.zip">csv (2 MB)</a></td>
<td><a href="/nuki/2020-10-15-nuki131-nuki-open.sr">sr (160 KB)</a></td>
</tr>
</tbody>
</table>

<p>Hier ist das Öffnen-Signal des Nuki Openers (<code>2020-10-15-nuki131-nuki-open</code>):</p>

<p><a href="../../nuki/2020-10-15-nuki131-nuki-open.jpg"><img src="../../nuki/2020-10-15-nuki131-nuki-open.thumb.1x.jpg" srcset="../../nuki/2020-10-15-nuki131-nuki-open.thumb.2x.jpg 2x,../../nuki/2020-10-15-nuki131-nuki-open.thumb.3x.jpg 3x" width="600" alt="2020-10-15-nuki131-nuki-open" style="border: 1px solid #000" loading="lazy"></a></p>

<h2 id="nuki-opener-software-version-1-5-3-kaputt">Nuki Opener Software-Version 1.5.3 (kaputt)</h2>

<p>Mit Software-Version 1.5.3 erscheint nach dem Anlernen im Debug Protokoll:</p>

<pre><code>bv/ct:277/261dV,ba:35%
R:n83,m31@0,d7
O:n7,m30@2,d0
</code></pre>

<p>Während sich Ring (<code>R</code>) noch in der Toleranz bewegt, sieht Open (<code>O</code>) sehr
anders aus.</p>

<p>Statt <code>0,d7</code> (7 Daten-Bytes, wie auf dem SCS Bus?) findet sich hier <code>2,d0</code>.</p>

<p>Die Länge des Signals wurde mit <code>n7</code> falsch erkannt.</p>

<table>
<thead>
<tr>
<th>Oszilloskop-Aufzeichnung SCS Bus</th>
<th>Rigol Waveform</th>
<th>CSV</th>
<th>Sigrok</th>
</tr>
</thead>

<tbody>
<tr>
<td>2020-10-09-nuki-open.sr</td>
<td><a href="/nuki/2020-10-09-nuki-open.wfm">wfm (1,1 MB)</a></td>
<td><a href="/nuki/2020-10-09-nuki-open.zip">csv (2 MB)</a></td>
<td><a href="/nuki/2020-10-09-nuki-open.sr">sr (160 KB)</a></td>
</tr>
</tbody>
</table>

<p>Hier ist das kaputte Öffnen-Signal des Nuki Openers (<code>2020-10-09-nuki-open</code>):</p>

<p><a href="../../nuki/2020-10-09-nuki-open.jpg"><img src="../../nuki/2020-10-09-nuki-open.thumb.1x.jpg" srcset="../../nuki/2020-10-09-nuki-open.thumb.2x.jpg 2x,../../nuki/2020-10-09-nuki-open.thumb.3x.jpg 3x" width="600" alt="2020-10-09-nuki-open" style="border: 1px solid #000" loading="lazy"></a></p>

<h2 id="appendix-a-installation-nuki-opener">Appendix A: Installation Nuki Opener</h2>

<p>Wie ich mein Nuki Opener installiert habe, ist in <a href="/posts/2020-09-28-nuki-scs-bticino-decoding/">meinem Post «Nuki Opener with
an SCS bus intercom (bTicino 344212)» vom
2020-09-28</a> ausführlich
beschrieben, inkl. Bilder.</p>

<h2 id="appendix-b-messumgebung">Appendix B: Messumgebung</h2>

<p>Die Messungen wurden mit einem Rigol DS1102E Oszilloskop angefertigt.</p>

<p>Kanal 1 war auf 10X eingestellt und an den SCS Bus angeschlossen.</p>

<p>Die Sample Rate war auf 10 MHz eingestellt, denn:</p>

<ol>
<li><code>Acquire</code> → <code>Memdepth</code> war auf <code>Long mem</code> eingestellt.</li>
<li>Die Time Base war auf 2ms eingestellt (→ <a href="https://www.eevblog.com/forum/blog/rigol-ds1052e-sample-rate-vs-timebase-setting/msg115617/#msg115617">Sample Rate
Tabelle</a>)</li>
</ol>

</div>

      </div>

    </main><div id="ms_footer">
  © 2021 Michael Stapelberg • all articles under <a href="https://creativecommons.org/licenses/by/4.0/">Creative Commons CC-BY license</a>
</div>
</body>
</html>
