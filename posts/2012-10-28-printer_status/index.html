<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Displaying your printer’s status</title>
    <meta name="viewport" content="width=device-width">
    <link rel="shortcut icon" href="/favicon.ico" />
    <meta name="description" content="Michael Stapelberg’s private website, containing articles about computers and programming, mostly focused on Linux.">
    <link rel="canonical" href="https://michael.stapelberg.ch/posts/2012-10-28-printer_status/">
    <meta name="author" content="Michael Stapelberg">
    <meta name="keywords" content="Michael, Stapelberg, Linux, Debian">
    <style type="text/css">
@font-face {
  font-family: 'Yanone Kaffeesatz Regular';
  font-style: normal;
  font-weight: 400;
  src: local('Yanone Kaffeesatz Regular'), url('/YanoneKaffeesatz-Regular.ttf') format('truetype');
}

@font-face {
  font-family: 'Droid Sans';
  font-style: normal;
  font-weight: normal;
  src: local('Droid Sans'), local('DroidSans'), url('/droid_sans.ttf') format('truetype');
}

@font-face {
  font-family: 'Droid Sans';
  font-style: normal;
  font-weight: bold;
  src: local('Droid Sans Bold'), local('DroidSans-Bold'), url('/droid_sans_bold.ttf') format('truetype');
}

body, td, th {
  font-family: 'Droid Sans', Verdana, Arial, Helvetica, sans-serif;
  font-size: 16px;
  color: #000;
} 
    </style>
    <link rel="stylesheet" href="/2.css" type="text/css">
    
    <link rel="stylesheet" href="/1.min.css" type="text/css"><link rel="alternate" href="/feed.xml" type="application/atom+xml" title="ATOM feed"></head>


  <body>
    <div class="container-fluid">
      <div class="row">
	<div id="menu" class="col-md-2">
  <div style="display: flex; align-items: center">
    <img src="/logo1x.jpg" srcset="/logo2x.jpg 2x, /logo3x.jpg 3x" width="45" style="border-radius: 40%; margin-right: .25em">
    <h1 style="letter-spacing: .75px">Michael Stapelberg</h1>
  </div>

  <ul class="menu_open">
    <li><a class="menu_item" href="/"><span class="menu_title">About</span></a></li>
    <li><a class="menu_item" href="/posts/"><span class="menu_title">Blog</span></a></li>
    <li><span class="menu_title">Programs</span>
      <div class="subitem">
	<ul class="menu_open">
	  <li><a class="menu_item" href="https://gokrazy.org/"><span class="menu_title">gokrazy</span></a></li>
	  <li><a class="menu_item" href="https://i3wm.org/"><span class="menu_title">i3</span></a></li>
	  <li><a class="menu_item" href="https://robustirc.net/"><span class="menu_title">RobustIRC</span></a></li>
	  <li><a class="menu_item" href="https://github.com/rtr7/router7/"><span class="menu_title">router7</span></a></li>
	  <li><a class="menu_item" href="https://www.x11vis.org/"><span class="menu_title">x11vis</span></a></li>
	  <li><a class="menu_item" href="/c128_kasse"><span class="menu_title">c128_kasse</span></a></li>
	</ul>
      </div>
    </li>

    <li><a class="menu_item" href="https://www.debian.org/"><span class="menu_title">Debian</span></a>
      <div class="subitem">
	<ul class="menu_open">
	  <li><a class="menu_item" href="https://codesearch.debian.net/"><span class="menu_title">Debian Code Search</span></a></li>
	  <li><a class="menu_item" href="https://manpages.debian.org/"><span class="menu_title">manpages.debian.org</span></a></li>
	</ul>
      </div>
    </li>

    <li><a class="menu_item" href="/talks"><span class="menu_title">Talks</span></a></li>
    <li><a class="menu_item" href="/series"><span class="menu_title">TV series</span></a></li>
  </ul>
</div>

	<div id="contentBox" class="col-md-10">
	  <h2 class="title">Displaying your printer’s status</h2>
	  <div style="margin-bottom: 2em">
	    <span id="date">published 2012-10-28, last modified 2018-03-18</span>
	    
	  
	  <span style="padding-left: 0.1em; padding-right: 0.1em; margin-left: .5em; margin-right: .5em"><a style="text-decoration: none; color: white" href="https://github.com/stapelberg/hugo/edit/master/content/posts/2012-10-28-printer_status.markdown"><img src="../../Bilder/pen-square-solid.svg" style="height: 1.25em"></a></span>
	  
	  </div>
	  <div class="Artikel" id="content">
	    <p>
At our house, we have a single, high-quality laser color printer in the
basement (along with the other computer equipment) which everybody uses, as
opposed to a crappy cheap printer at everyone’s workplace. This is a great
setup in our situation, since nobody prints a lot individually, so the slight
discomfort of having to go to the basement is a welcome trade-off for not
having to maintain cheap printers.
</p>

<p>
The only problem with this is the lack of feedback from the printer. That is,
when you printed your document from, say, your web browser, you have no way of
knowing when printing finished. Sure, you could go to the CUPS print server and
repeatedly watch to know when CUPS finished spooling the job. But that’s rather
inconvenient and won’t tell you what’s wrong in case the printer does
<strong>not</strong> print as expected (it will just sit there, or be paused).
</p>

<p>
What happened in reality is that I send the print job, wait a certain amount of
time (roughly corresponding with the document size) and just walk into the
basement. That usually works, except when it doesn’t.
</p>

<p>
Therefore, I wrote a little script which will display the printer’s status
(effectively what it displays on the LCD) using a Freedesktop notification
whenever the status changes. It looks like this in action:
</p>

<p><img src="/Bilder/printer-status.png" alt="printer status screenshot" width="358" height="38"></p>

<p>
…where "kyocera" is the hostname of the printer and "Es wird gedruckt" is the
german way of saying "printing". The program displaying the notification is <a
href="http://knopwob.github.com/dunst/">dunst, a dmenu-ish
notification-daemon</a> which I can recommend.
</p>

<p>
You can find <a
href="http://code.stapelberg.de/git/notify-printer-status/tree/notify-printer-status">the
script called notify-printer-status here</a> (how creative, eh?). Since the
source code is only 44 lines long (including comments and boilerplate), adding
configuration logic seems to be overkill. Instead, just modify your copy of it.
I’ve been using the script since over a month and it’s been working fine, so I
doubt there are any serious bugs in the code.
</p>

<p>
To use it, you first need an SNMP-capable printer (doh). Then, install the Perl
modules Net::SNMP and Desktop::Notify (<code>sudo apt-get install
libnet-snmp-perl libdesktop-notify-perl</code> on Debian). Now replace the
hostname and find out the SNMP OID for your printer. This is surprisingly hard,
but one way I’ve found to work well for me is to use snmpwalk, distributed as
an example with Net::SNMP, and grep for what the printer currently displays:
</p>

<pre>
$ zcat /usr/share/doc/libnet-snmp-perl/examples/snmpwalk.pl.gz > snmapwalk.pl
$ perl snmapwalk.pl kyocera.rag.lan | grep Ruhemodus
1.3.6.1.2.1.43.16.5.1.2.1.1 = OCTET STRING: Ruhemodus
</pre>

<p>
Afterwards, just start the script in your <code>~/.xsession</code> and forget
about it. Enjoy!
</p>

	  </div>
	</div>
      </div>
    </div>
  </body>
</html>
