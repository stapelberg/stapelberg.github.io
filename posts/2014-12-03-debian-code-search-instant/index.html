<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Announcing the new Debian Code Search Instant (2014) - Michael Stapelberg</title>

  <meta property="og:site_name" content="Michael Stapelberg">
  <meta property="og:title" content="Announcing the new Debian Code Search Instant">
  <meta property="og:description" content="For the last few months, I have been working on a new version of Debian Code Search, and today it’s going live! I call it Debian Code Search Instant, for multiple reasons, see below. A lot faster The new Debian Code Search is still hosted by Rackspace (thank you!">
  
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
  <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
  <link rel="icon" type="image/png" href="/favicon-48x48.png" sizes="48x48">
  <link rel="apple-touch-icon" sizes="152x152" href="/apple-touch-icon-152x152.png">
  <meta name="description" content="For the last few months, I have been working on a new version of Debian Code Search, and today it’s going live! I call it Debian Code Search Instant, for multiple reasons, see below. A lot faster The new Debian Code Search is still hosted by Rackspace (thank you!">
  <link rel="canonical" href="https://michael.stapelberg.ch/posts/2014-12-03-debian-code-search-instant/">
  <meta name="author" content="Michael Stapelberg">
  <style type="text/css">
    @font-face {
	font-family: 'Roboto Mono';
	src: url('/font/subset-RobotoMono-Regular.eot');
	src: local('Roboto Mono Regular'), local('RobotoMono-Regular'),
        url('/font/subset-RobotoMono-Regular.eot?#iefix') format('embedded-opentype'),
        url('/font/subset-RobotoMono-Regular.woff2') format('woff2'),
        url('/font/subset-RobotoMono-Regular.woff') format('woff'),
        url('/font/subset-RobotoMono-Regular.ttf') format('truetype');
	font-weight: normal;
	font-style: normal;
	font-display: swap;
    }

    @font-face {
	font-family: 'Roboto';
	src: url('/font/subset-Roboto-Bold.eot');
	src: local('Roboto Bold'), local('Roboto-Bold'),
        url('/font/subset-Roboto-Bold.eot?#iefix') format('embedded-opentype'),
        url('/font/subset-Roboto-Bold.woff2') format('woff2'),
        url('/font/subset-Roboto-Bold.woff') format('woff'),
        url('/font/subset-Roboto-Bold.ttf') format('truetype');
	font-weight: bold;
	font-style: normal;
	font-display: swap;
    }

    @font-face {
	font-family: 'Roboto';
	src: url('/font/subset-Roboto-Regular.eot');
	src: local('Roboto'), local('Roboto-Regular'),
        url('/font/subset-Roboto-Regular.eot?#iefix') format('embedded-opentype'),
        url('/font/subset-Roboto-Regular.woff2') format('woff2'),
        url('/font/subset-Roboto-Regular.woff') format('woff'),
        url('/font/subset-Roboto-Regular.ttf') format('truetype');
	font-weight: normal;
	font-style: normal;
	font-display: swap;
    }

    @font-face {
	font-family: 'Lato';
	src: url('/font/subset-Lato-Bold.eot');
	src: local('Lato Bold'), local('Lato-Bold'),
        url('/font/subset-Lato-Bold.eot?#iefix') format('embedded-opentype'),
        url('/font/subset-Lato-Bold.woff2') format('woff2'),
        url('/font/subset-Lato-Bold.woff') format('woff'),
        url('/font/subset-Lato-Bold.ttf') format('truetype');
	font-weight: bold;
	font-style: normal;
	font-display: swap;
    }

    body, td, th {
	font-family: 'Roboto';
	font-size: 16px;
	line-height: 150%;
	color: #000;
    }

    h1,
    h2,
    h3,
    h4,
    h5,
    h6 {
	font-family: 'Lato';
	font-weight: bold;
	font-variant-ligatures: none;
	color: #000;
    }
  </style>

  
  <link rel="preload" href="/font/subset-Lato-Bold.woff2" as="font" type="font/woff2" crossorigin>
  <link rel="preload" href="/font/subset-Roboto-Regular.woff2" as="font" type="font/woff2" crossorigin>

  

  
  <link rel="stylesheet" href="/1.min.css?cachebust=sha512-0KNb0FMBigC18vvjx7OX9%2brtwvlFcqRW9ot8oyvDaFTNa8BkK%2bXi6zXmEodv2l64rdRSjQ2aU8LqbO%2b3FR%2bSdA%3d%3d" type="text/css">
  <link rel="alternate" href="/feed.xml" type="application/atom+xml" title="ATOM feed">
</head>
<body>



<header id="ms_navbar">
  <a href="/">
<img
    src="/logo1x.jpg"
    srcset="/logo2x.jpg 2x, /logo3x.jpg 3x"
    width="42"
    height="52"
    alt="profile picture"
    title="profile picture">
</a>
  <div>
    <a href="/"><h1>Michael Stapelberg</h1></a>
    <nav id="ms_desktopnav">
      <ul>
	
    <li><a href="/" >About</a></li>
    <li><a href="/posts/" class="active">Blog</a></li>
    <li><a href="/talks/" >Talks</a></li>
    <li><a href="/series/" >Series</a></li>

      </ul>
    </nav>
  </div>

  <div id="ms_burger_open">
    <label for="ms_burger"><svg viewBox="0 0 100 80" width="24" height="24">
	<rect width="100" height="17" rx="8" fill="white"></rect>
	<rect y="30" width="100" height="17" rx="8" fill="white"></rect>
	<rect y="60" width="100" height="17" rx="8" fill="white"></rect>
    </svg></label>
  </div>

  <input type="checkbox" id="ms_burger">

  <nav id="ms_navdrawer">
    <div id="ms_navdrawer_top">
      <div id="ms_navdrawer_search">
	<a href="/">
<img
    src="/logo1x.jpg"
    srcset="/logo2x.jpg 2x, /logo3x.jpg 3x"
    width="42"
    height="52"
    alt="profile picture"
    title="profile picture">

	<h1>Michael Stapelberg</h1></a>
      </div>
      <div id="ms_burger_close">
	<label for="ms_burger"><svg viewBox="0 0 110 110" width="24" height="24">
	    <line x1="10" y1="10" x2="100" y2="100" stroke="#047bc2" stroke-width="20" />
	    <line x1="100" y1="10" x2="10" y2="100" stroke="#047bc2" stroke-width="20" />
	</svg></label>
      </div>
    </div>

    <div id="ms_navdrawer_content">
      <ul>
	
    <li><a href="/" >About</a></li>
    <li><a href="/posts/" class="active">Blog</a></li>
    <li><a href="/talks/" >Talks</a></li>
    <li><a href="/series/" >Series</a></li>

      </ul>
    </div>
  </nav>
</header>
<main>
      <div>
<h1 class="ms_title">Announcing the new Debian Code Search Instant (2014)</h1>

<div class="ms_meta">
  <div id="ms_date">published 2014-12-03, last modified 2019-02-04</div>
  
  
  <div id="ms_tags">
  
  in tag
  
  
  <span class="ms_tag"><a href="/posts/tags/debian/">debian</a></span>
  
  </div>
  
  <div>
    <a href="https://github.com/stapelberg/hugo/edit/master/content/posts/2014-12-03-debian-code-search-instant.html"><img src="/Bilder/pen-square-solid.svg" width="18" height="20" alt="Edit Icon" title="Suggest a change to this article"></a>
  </div>
  
</div>
<div class="Artikel" id="content">
  <p>
For the last few months, I have been working on a new version of Debian Code
Search, and today it’s going live! I call it <a
href="http://codesearch.debian.net/">Debian Code Search Instant</a>, for
multiple reasons, see below.
</p>

<h3>A lot faster</h3>

<p>
The new Debian Code Search is still hosted by <a
href="http://rackspace.com/">Rackspace</a> (thank you!), but our new
architecture finally allows us to use their <a
href="http://www.rackspace.com/blog/got-the-need-for-speed-meet-performance-cloud-servers/">“Performance
Cloud Servers” hardware generation</a>.
</p>

<p>
The old code search architecture was split across 5 different servers, however
the search itself was only performed on a single machine with a network
attached block volume backed by SSD. The new Code Search spreads
out both the trigram index and the source code onto 6 different servers, and
thanks to the new hardware generation, we have a locally connected SSD drive in
each of them. So, we now get more than 6 times the IOPS we’ve had before, at
much lower latency :).
</p>

<h3>Grouping by Debian source package</h3>

<p>
<a href="https://github.com/Debian/dcs/issues/1">The first feature request</a>
we ever got for Code Search was to group results by Debian source package. I’ve
tried tackling that before, but it’s a pretty hard problem. With the new
architecture and capacity, this finally becomes feasible.
</p>

<p>
After your query completes, there is a checkbox called “Group search results by
Debian source package”. Enable it, and you’ll get neatly grouped results. For
each package, there is a link at the bottom to refine the search to only
consider that package.
</p>

<p>
In case you are more interested in the full list of packages, for example
because you are doing large-scale changes across Debian, that’s also possible:
Click on the ▾ symbol right next to the “Filter by package” list, and a curl
command will be revealed with which you can download the full list of packages.
</p>

<h3>Expensive queries (with lots of results) now possible</h3>

<p>
Previously, we had a 60 second timeout during which queries must complete. This
timeout has been completely lifted, and long-running queries with tons and tons
of results are now possible. We kindly ask you to not abuse this feature — it’s
not very exciting to play with complexity explosion in regular expression
engines by preventing others from doing their work. If you’re interested in
that sort of analysis, go grab <a href="https://github.com/Debian/dcs">the
source code</a> and play with it on your own machine :).
</p>

<h3>Instant results</h3>

<p>
While your query is running, you will almost immediately see the top 10
results, even though the search may still take a while. This is useful to
figure out if your regular expression matches what you thought it would, before
having to wait until your 5 minute query is finished.
</p>

<p>
Also, the new progress bar tells you how far the system is with your search.
</p>

<h3>Instant indexing</h3>

<p>
Previously, Code Search was deployed to a new set of machines from scratch
every week in order to update the index. This was necessary because the
performance would severely degrade while building the index, so we were
temporarily running with twice the amount of machines until the new version was
up.
</p>

<p>
In the new architecture, we store an index for each source package and then <a
href="https://github.com/Debian/dcs/blob/master/index/concatn.go">merge these
into one big index shard</a>. This currently takes about 4 minutes with the
code I wrote, but I’m sure this can be made even faster if necessary. So,
whenever new packages are uploaded to the Debian archive, we can just index the
new version and trigger a merge. We get notifications about new package uploads
from <a href="https://wiki.debian.org/FedMsg">FedMsg</a>. Packages that are not
seen on FedMsg for some reason are backfilled every hour.
</p>

<p>
The time between uploading a package and being able to find it in Debian Code
Search therefore now ranges from a couple of minutes to about an hour, instead
of about a week!
</p>

<h3>New, beautiful User Interface</h3>

<p>
Since we needed to rewrite the User Interface anyway thanks to the new
architecture, we also spent some effort on making it modern, polished and
beautiful.
</p>

<p>
Smooth CSS animations make you aware of what’s going on, and the search results
look cleaner than ever.
</p>

<h3>Conclusion</h3>

<p>
At least to me, the new Debian Code Search seems like a significant improvement
over the old one. I hope you enjoy the new features into which I put a lot of
work. In case you have any feedback, I’m happy to hear it (see the “contact”
link at the bottom of every Code Search site).
</p>
<div id="bmc">
  <p>
    I run a blog since 2005, spreading knowledge and experience for almost 20 years! :)
  </p>
  <p>
    If you want to support my work, you
    can <a href="https://www.buymeacoffee.com/stapelberg">buy me a coffee</a>.
  </p>
  <p>
    Thank you for your support! ❤️
  </p>
</div>

</div>

      </div>

    </main><div id="ms_footer">
  © 2024 Michael Stapelberg • all articles under <a href="https://creativecommons.org/licenses/by/4.0/">Creative Commons CC-BY license</a>
</div>
</body>
</html>
